YUI.add("hermes-template-photo-faved-by-list",function(e,a){var t=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,a,t,l,r){var i,s=e.lookupProperty||function(e,a){if(Object.prototype.hasOwnProperty.call(e,a))return e[a]};return'<ul class="photo-faved-by-list loading">\n\t<li class="loading-item">\n'+(null!=(i=e.invokePartial(s(l,"flickr-balls"),a,{name:"flickr-balls",data:r,indent:"\t\t",helpers:t,partials:l,decorators:e.decorators}))?i:"")+"\t</li>\n</ul>\n"},usePartial:!0,useData:!0}),l={};e.Array.each(["flickr-balls"],function(a){var t=e.Template.get("hermes/"+a);t&&(l[a]=t)}),e.Template.register("hermes/photo-faved-by-list",function(a,r){return r=r||{},r.partials=r.partials?e.merge(l,r.partials):l,t(a,r)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-flickr-balls"]});YUI.add("hermes-template-person",function(n,l){var e=n.Template.Handlebars.revive({1:function(n,l,e,a,t){var r,o=n.lambda,s=n.escapeExpression,c=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"data-"+s(o(null!=(r=null!=l?c(l,"dataAttr"):l)?c(r,"key"):r,l))+'="'+s(o(null!=(r=null!=l?c(l,"dataAttr"):l)?c(r,"value"):r,l))+'"'},3:function(n,l,e,a,t){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return n.escapeExpression(n.lambda(null!=(r=null!=l?o(l,"buddyicon"):l)?o(r,"default"):r,l))},5:function(n,l,e,a,t){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return n.escapeExpression("function"==typeof(r=null!=(r=o(e,"buddyicon")||(null!=l?o(l,"buddyicon"):l))?r:n.hooks.helperMissing)?r.call(null!=l?l:n.nullContext||{},{name:"buddyicon",hash:{},data:t,loc:{start:{line:5,column:68},end:{line:5,column:81}}}):r)},7:function(n,l,e,a,t){return'\t<a class="remove-person hide-text ui-icon-comment-delete" href="#">x</a>\n'},compiler:[8,">= 4.3.0"],main:function(n,l,e,a,t){var r,o,s=null!=l?l:n.nullContext||{},c=n.hooks.helperMissing,i="function",u=n.escapeExpression,p=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'<li class="person" '+(null!=(r=p(e,"if").call(s,null!=l?p(l,"dataAttr"):l,{name:"if",hash:{},fn:n.program(1,t,0),inverse:n.noop,data:t,loc:{start:{line:1,column:19},end:{line:1,column:84}}}))?r:"")+'>\n\t<a class="'+u(typeof(o=null!=(o=p(e,"extraClasses")||(null!=l?p(l,"extraClasses"):l))?o:c)===i?o.call(s,{name:"extraClasses",hash:{},data:t,loc:{start:{line:2,column:11},end:{line:2,column:27}}}):o)+'" href="/photos/'+u(typeof(o=null!=(o=p(e,"pathAlias")||(null!=l?p(l,"pathAlias"):l))?o:c)===i?o.call(s,{name:"pathAlias",hash:{},data:t,loc:{start:{line:2,column:43},end:{line:2,column:56}}}):o)+'/" data-track="'+u(typeof(o=null!=(o=p(e,"dataTrackPrefix")||(null!=l?p(l,"dataTrackPrefix"):l))?o:c)===i?o.call(s,{name:"dataTrackPrefix",hash:{},data:t,loc:{start:{line:2,column:71},end:{line:2,column:90}}}):o)+'PersonIconClick">\n\t\t<span class="person-icon">\n\t\t\t<span class="avatar person circle-icon" data-person-nsid="'+u(typeof(o=null!=(o=p(e,"nsid")||(null!=l?p(l,"nsid"):l))?o:c)===i?o.call(s,{name:"nsid",hash:{},data:t,loc:{start:{line:4,column:61},end:{line:4,column:69}}}):o)+'">\n\t\t\t\t<img src="'+(null!=(r=p(e,"if").call(s,null!=(r=null!=l?p(l,"buddyicon"):l)?p(r,"default"):r,{name:"if",hash:{},fn:n.program(3,t,0),inverse:n.program(5,t,0),data:t,loc:{start:{line:5,column:14},end:{line:5,column:88}}}))?r:"")+'" width="'+u(typeof(o=null!=(o=p(e,"size")||(null!=l?p(l,"size"):l))?o:c)===i?o.call(s,{name:"size",hash:{},data:t,loc:{start:{line:5,column:97},end:{line:5,column:105}}}):o)+'" height="'+u(typeof(o=null!=(o=p(e,"size")||(null!=l?p(l,"size"):l))?o:c)===i?o.call(s,{name:"size",hash:{},data:t,loc:{start:{line:5,column:115},end:{line:5,column:123}}}):o)+'">\n\t\t\t</span>\n\t\t\t<span class="person-name">\n\t\t\t\t'+u((p(e,"truncate")||l&&p(l,"truncate")||c).call(s,null!=l?p(l,"displayname"):l,20,{name:"truncate",hash:{},data:t,loc:{start:{line:8,column:4},end:{line:8,column:31}}}))+"\n\t\t\t</span>\n\t\t</span>\n\t</a>\n"+(null!=(r=p(e,"if").call(s,null!=l?p(l,"showRemove"):l,{name:"if",hash:{},fn:n.program(7,t,0),inverse:n.noop,data:t,loc:{start:{line:12,column:1},end:{line:14,column:8}}}))?r:"")+"</li>\n"},useData:!0}),a={};n.Array.each([],function(l){var e=n.Template.get("hermes/"+l);e&&(a[l]=e)}),n.Template.register("hermes/person",function(l,t){return t=t||{},t.partials=t.partials?n.merge(a,t.partials):a,e(l,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-faved-by-list-view",function(e,t){require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("photo-faved-by-list-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.photoId=e.photoId,this.excludedNsids=e.excludedNsids||[],this.pageNum=1},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerWithTemplate("photo-faved-by-list",{}),this},activate:function(){var t=this,i=this.get("container");return this.listNode=i.one(".photo-faved-by-list"),this.listNode.removeClass("loading"),i.one(".loading-item").remove(),this.scrollContainer=this.listNode,this.registerEventHandler(this.scrollContainer.on("scroll",e.betterThrottle(this.handleScroll.bind(this),200,this,!1))),this.appContext.getModel("photo-people-who-faved-models",this.photoId).then(function(e){return t.peopleWhoFavedModel=e,t.loadMore()}).then(function(e){return t.appendNewPeople(e),t.fire("loaded"),e})},loadMore:function(){var e=this;return this.isLoadingMore=!0,this.peopleWhoFavedModel.getValue("people").getPage({page:this.pageNum++,perPage:50}).then(function(t){return e.isLoadingMore=!1,(t=t.filter(function(t){return!e.excludedNsids.includes(t.getValue("nsid"))})).map(function(e){return{id:e.id,nsid:e.getValue("nsid"),pathAlias:e.getValue("pathAlias")+"/favorites",buddyicon:e.getValue("buddyicon"),displayname:e.getValue("displayname"),size:30,dataTrackPrefix:"whoFaved"}})}).catch(function(t){e.isLoadingMore=!1})},appendNewPeople:function(t){var i=this;return t&&0!==t.length?(t.forEach(function(t){var o=i.templates("person")(t),n=e.Node.create('<li class="person-item"></li>');n.set("innerHTML",o),i.listNode.appendChild(n)}),t):e.Promise.resolve()},handleScroll:function(){var e=this,t=this.scrollContainer.get("scrollTop"),i=this.scrollContainer.get("scrollHeight"),o=this.scrollContainer.get("clientHeight");!this.isLoadingMore&&t+o+750>i&&this.loadMore().then(function(t){return e.appendNewPeople(t)})}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-faved-by-list","hermes-template-person"],langBundles:["common"]});YUI.add("hermes-template-sub-photo-faved-by",function(l,n){var e=l.Template.Handlebars.revive({1:function(l,n,e,t,a){var o,r=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return"\n"+(null!=(o=r(e,"if").call(null!=n?n:l.nullContext||{},null!=n?r(n,"totalPeopleFaved"):n,{name:"if",hash:{},fn:l.program(2,a,0),inverse:l.noop,data:a,loc:{start:{line:7,column:1},end:{line:16,column:8}}}))?o:"")},2:function(l,n,e,t,a){var o,r=null!=n?n:l.nullContext||{},p=l.hooks.helperMissing,i=l.escapeExpression,u=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return'\t\t<div class="sub-photo-faved-by">\n\t\t\t<a class="fave-thumb" href="'+i("function"==typeof(o=null!=(o=u(e,"thumbUrl")||(null!=n?u(n,"thumbUrl"):n))?o:p)?o.call(r,{name:"thumbUrl",hash:{},data:a,loc:{start:{line:9,column:31},end:{line:9,column:43}}}):o)+'" style="background-image: url('+i("function"==typeof(o=null!=(o=u(e,"displayUrl")||(null!=n?u(n,"displayUrl"):n))?o:p)?o.call(r,{name:"displayUrl",hash:{},data:a,loc:{start:{line:9,column:74},end:{line:9,column:88}}}):o)+')"></a>\n\t\t\t<div class="faved-by-line-container">\n\t\t\t\t<div class="faved-by">\n\t\t\t\t\t'+i((u(e,"preventOrphans")||n&&u(n,"preventOrphans")||p).call(r,(u(e,"renderTrustedMarkup")||n&&u(n,"renderTrustedMarkup")||p).call(r,null!=n?u(n,"favedByLine"):n,{name:"renderTrustedMarkup",hash:{},data:a,loc:{start:{line:12,column:22},end:{line:12,column:55}}}),{name:"preventOrphans",hash:{},data:a,loc:{start:{line:12,column:5},end:{line:12,column:57}}}))+"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n"},4:function(l,n,e,t,a){var o,r=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return null!=(o=r(e,"if").call(null!=n?n:l.nullContext||{},null!=n?r(n,"totalPeopleFaved"):n,{name:"if",hash:{},fn:l.program(5,a,0),inverse:l.noop,data:a,loc:{start:{line:18,column:1},end:{line:61,column:8}}}))?o:""},5:function(l,n,e,t,a){var o,r=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return'\t\t<i class="animated-fave-star"></i>\n\t\t\n\t\t<div class="faved-by">\n\t\t\t<div class="initial-faved-by-display">\n'+(null!=(o=(r(e,"ifCond")||n&&r(n,"ifCond")||l.hooks.helperMissing).call(null!=n?n:l.nullContext||{},null!=n?r(n,"totalPeopleFaved"):n,"===",1,{name:"ifCond",hash:{},fn:l.program(6,a,0),inverse:l.program(8,a,0),data:a,loc:{start:{line:23,column:4},end:{line:58,column:15}}}))?o:"")+"\t\t\t</div>\n\t\t</div>\n"},6:function(l,n,e,t,a){var o,r=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return"\t\t\t\t\t"+l.escapeExpression((r(e,"intlHTMLMessage")||n&&r(n,"intlHTMLMessage")||l.hooks.helperMissing).call(null!=n?n:l.nullContext||{},{name:"intlHTMLMessage",hash:{displayName:null!=(o=null!=(o=null!=n?r(n,"people"):n)?r(o,"0"):o)?r(o,"displayname"):o,pathAlias:null!=(o=null!=(o=null!=n?r(n,"people"):n)?r(o,"0"):o)?r(o,"pathAlias"):o,intlName:"photo-page-scrappy.SINGLE_FAVER"},data:a,loc:{start:{line:24,column:5},end:{line:27,column:7}}}))+"\n"},8:function(l,n,e,t,a){var o,r=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return null!=(o=(r(e,"ifCond")||n&&r(n,"ifCond")||l.hooks.helperMissing).call(null!=n?n:l.nullContext||{},null!=n?r(n,"totalPeopleFaved"):n,"===",2,{name:"ifCond",hash:{},fn:l.program(9,a,0),inverse:l.program(11,a,0),data:a,loc:{start:{line:29,column:5},end:{line:57,column:16}}}))?o:""},9:function(l,n,e,t,a){var o,r=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return"\t\t\t\t\t\t"+l.escapeExpression((r(e,"intlHTMLMessage")||n&&r(n,"intlHTMLMessage")||l.hooks.helperMissing).call(null!=n?n:l.nullContext||{},{name:"intlHTMLMessage",hash:{displayNameTwo:null!=(o=null!=(o=null!=n?r(n,"people"):n)?r(o,"1"):o)?r(o,"displayname"):o,pathAliasTwo:null!=(o=null!=(o=null!=n?r(n,"people"):n)?r(o,"1"):o)?r(o,"pathAlias"):o,displayNameOne:null!=(o=null!=(o=null!=n?r(n,"people"):n)?r(o,"0"):o)?r(o,"displayname"):o,pathAliasOne:null!=(o=null!=(o=null!=n?r(n,"people"):n)?r(o,"0"):o)?r(o,"pathAlias"):o,intlName:"photo-page-scrappy.DOUBLE_FAVER"},data:a,loc:{start:{line:30,column:6},end:{line:35,column:8}}}))+"\n"},11:function(l,n,e,t,a){var o,r=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return null!=(o=(r(e,"ifCond")||n&&r(n,"ifCond")||l.hooks.helperMissing).call(null!=n?n:l.nullContext||{},null!=n?r(n,"totalPeopleFaved"):n,">",2,{name:"ifCond",hash:{},fn:l.program(12,a,0),inverse:l.noop,data:a,loc:{start:{line:37,column:6},end:{line:56,column:17}}}))?o:""},12:function(l,n,e,t,a){var o,r=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return null!=(o=(r(e,"ifCond")||n&&r(n,"ifCond")||l.hooks.helperMissing).call(null!=n?n:l.nullContext||{},null!=n?r(n,"remainingFavedBy"):n,"===",1,{name:"ifCond",hash:{},fn:l.program(13,a,0),inverse:l.program(15,a,0),data:a,loc:{start:{line:38,column:7},end:{line:55,column:18}}}))?o:""},13:function(l,n,e,t,a){var o,r=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return"\t\t\t\t\t\t\t\t"+l.escapeExpression((r(e,"intlHTMLMessage")||n&&r(n,"intlHTMLMessage")||l.hooks.helperMissing).call(null!=n?n:l.nullContext||{},{name:"intlHTMLMessage",hash:{displayNameThree:null!=(o=null!=(o=null!=n?r(n,"people"):n)?r(o,"2"):o)?r(o,"displayname"):o,pathAliasThree:null!=(o=null!=(o=null!=n?r(n,"people"):n)?r(o,"2"):o)?r(o,"pathAlias"):o,displayNameTwo:null!=(o=null!=(o=null!=n?r(n,"people"):n)?r(o,"1"):o)?r(o,"displayname"):o,pathAliasTwo:null!=(o=null!=(o=null!=n?r(n,"people"):n)?r(o,"1"):o)?r(o,"pathAlias"):o,displayNameOne:null!=(o=null!=(o=null!=n?r(n,"people"):n)?r(o,"0"):o)?r(o,"displayname"):o,pathAliasOne:null!=(o=null!=(o=null!=n?r(n,"people"):n)?r(o,"0"):o)?r(o,"pathAlias"):o,intlName:"photo-page-scrappy.TRIPLE_FAVER"},data:a,loc:{start:{line:39,column:8},end:{line:46,column:10}}}))+"\n"},15:function(l,n,e,t,a){var o,r=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return"\t\t\t\t\t\t\t\t"+l.escapeExpression((r(e,"intlHTMLMessage")||n&&r(n,"intlHTMLMessage")||l.hooks.helperMissing).call(null!=n?n:l.nullContext||{},{name:"intlHTMLMessage",hash:{count:null!=n?r(n,"remainingFavedBy"):n,displayNameTwo:null!=(o=null!=(o=null!=n?r(n,"people"):n)?r(o,"1"):o)?r(o,"displayname"):o,pathAliasTwo:null!=(o=null!=(o=null!=n?r(n,"people"):n)?r(o,"1"):o)?r(o,"pathAlias"):o,displayNameOne:null!=(o=null!=(o=null!=n?r(n,"people"):n)?r(o,"0"):o)?r(o,"displayname"):o,pathAliasOne:null!=(o=null!=(o=null!=n?r(n,"people"):n)?r(o,"0"):o)?r(o,"pathAlias"):o,intlName:"photo-page-scrappy.MULTI_FAVER"},data:a,loc:{start:{line:48,column:8},end:{line:54,column:10}}}))+"\n"},compiler:[8,">= 4.3.0"],main:function(l,n,e,t,a){var o,r=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return null!=(o=(r(e,"isFlipped")||n&&r(n,"isFlipped")||l.hooks.helperMissing).call(null!=n?n:l.nullContext||{},"enable-likes",{name:"isFlipped",hash:{},fn:l.program(1,a,0),inverse:l.program(4,a,0),data:a,loc:{start:{line:1,column:0},end:{line:62,column:14}}}))?o:""},useData:!0}),t={};l.Array.each([],function(n){var e=l.Template.get("hermes/"+n);e&&(t[n]=e)}),l.Template.register("hermes/sub-photo-faved-by",function(n,a){return a=a||{},a.partials=a.partials?l.merge(t,a.partials):t,e(n,a)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-fave-menu",function(e,n){var r=e.Template.Handlebars.revive({1:function(e,n,r,l,t){var o,a=null!=n?n:e.nullContext||{},u=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return"\t<ul>\n"+(null!=(o=u(r,"each").call(a,null!=n?u(n,"people"):n,{name:"each",hash:{},fn:e.program(2,t,0),inverse:e.noop,data:t,loc:{start:{line:3,column:2},end:{line:5,column:11}}}))?o:"")+(null!=(o=u(r,"if").call(a,null!=n?u(n,"moreCount"):n,{name:"if",hash:{},fn:e.program(4,t,0),inverse:e.noop,data:t,loc:{start:{line:6,column:2},end:{line:8,column:9}}}))?o:"")+"\t</ul>\n"},2:function(e,n,r,l,t){var o,a=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(o=e.invokePartial(a(l,"person"),n,{name:"person",data:t,indent:"\t\t\t",helpers:r,partials:l,decorators:e.decorators}))?o:""},4:function(e,n,r,l,t){var o,a=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return"\t\t\t<li class='faves-more'><a href='#'>"+e.escapeExpression("function"==typeof(o=null!=(o=a(r,"moreCount")||(null!=n?a(n,"moreCount"):n))?o:e.hooks.helperMissing)?o.call(null!=n?n:e.nullContext||{},{name:"moreCount",hash:{},data:t,loc:{start:{line:7,column:38},end:{line:7,column:51}}}):o)+" more</a></li>\n"},compiler:[8,">= 4.3.0"],main:function(e,n,r,l,t){var o,a=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(o=a(r,"if").call(null!=n?n:e.nullContext||{},null!=n?a(n,"people"):n,{name:"if",hash:{},fn:e.program(1,t,0),inverse:e.noop,data:t,loc:{start:{line:1,column:0},end:{line:10,column:7}}}))?o:""},usePartial:!0,useData:!0}),l={};e.Array.each(["person"],function(n){var r=e.Template.get("hermes/"+n);r&&(l[n]=r)}),e.Template.register("hermes/fave-menu",function(n,t){return t=t||{},t.partials=t.partials?e.merge(l,t.partials):l,r(n,t)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-person"]});YUI.add("flickr-photos-getFavorites-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-photos-getFavorites"]={run:function(p,r){var t,s=this;return r.flipper.isFlipped("enable-scrappy-photo-page")&&(p.scrappy=!0),t=this._processParams(p,r),e.Promise.all([r.callAPI("flickr.photos.getFavorites",t,!0),r.getModelRegistry("photo-people-who-faved-models"),r.getModelRegistry("person-models"),r.getModelRegistry("person-relationship-models")]).then(function(e){return s._processResponse(e,p,t)},e.FetcherErrorLogger(o))},_processParams:function(o,p){var r;return r={photo_id:o.id,extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:o.perPage||50,page:o.page||1,hermes:1},o.scrappy&&(r.sort=p.flipper.isFlipped("enable-fave-list-modal")?"date_desc":"date_asc"),r},_processResponse:function(o,p,r){var t,s=o[0],a=o[1],l=o[2],i=o[3];return t={id:s.photo.id,total:s.photo.total,people:[]},s.photo.person&&s.photo.person.forEach(function(o){var p=e.APIHelper.response.parsePerson(o);i.addOrUpdate(e.APIHelper.response.parseRelationship(o)),t.people.push(l.addOrUpdate(p))}),t.people={perPage:r.per_page,page:r.page,pageContent:t.people,totalItems:parseInt(t.total||0,10)},a.addOrUpdate(t),t.people.pageContent}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-people-who-faved-models","person-models"]});YUI.add("photo-people-who-faved-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-photos-getFavorites"].run(t,this.appContext)}},attributes:{total:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},people:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-photos-getFavorites"]}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-getFavorites-fetcher"]});