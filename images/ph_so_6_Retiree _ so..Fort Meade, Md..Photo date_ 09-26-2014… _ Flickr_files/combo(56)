YUI.add("hermes-template-infinite-scroll-load-more",function(e,a){var t=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,a,t,n,l){var r=e.lookupProperty||function(e,a){if(Object.prototype.hasOwnProperty.call(e,a))return e[a]};return'<div class="infinite-scroll-load-more">\n\t<button class="alt">'+e.escapeExpression((r(t,"intlMessage")||a&&r(a,"intlMessage")||e.hooks.helperMissing).call(null!=a?a:e.nullContext||{},{name:"intlMessage",hash:{intlName:"common.LOAD_MORE_RESULTS"},data:l,loc:{start:{line:2,column:21},end:{line:2,column:72}}}))+"</button>\n</div>"},useData:!0}),n={};e.Array.each([],function(a){var t=e.Template.get("hermes/"+a);t&&(n[a]=t)}),e.Template.register("hermes/infinite-scroll-load-more",function(a,l){return l=l||{},l.partials=l.partials?e.merge(n,l.partials):n,t(a,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-license-detail",function(e,a){var l=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,a,l,n,t){var s=null!=a?a:e.nullContext||{},r=e.hooks.helperMissing,i=e.escapeExpression,o=e.lookupProperty||function(e,a){if(Object.prototype.hasOwnProperty.call(e,a))return e[a]};return'<p class="secondary" style="margin-top: 0;">'+i((o(l,"intlMessage")||a&&o(a,"intlMessage")||r).call(s,{name:"intlMessage",hash:{intlName:null!=a?o(a,"title"):a},data:t,loc:{start:{line:1,column:44},end:{line:1,column:74}}}))+'</p>\n<p class="secondary" style="margin-bottom: 0;">'+i((o(l,"intlMessage")||a&&o(a,"intlMessage")||r).call(s,{name:"intlMessage",hash:{intlName:null!=a?o(a,"body"):a},data:t,loc:{start:{line:2,column:47},end:{line:2,column:76}}}))+"</p>\n"},useData:!0}),n={};e.Array.each([],function(a){var l=e.Template.get("hermes/"+a);l&&(n[a]=l)}),e.Template.register("hermes/license-detail",function(a,t){return t=t||{},t.partials=t.partials?e.merge(n,t.partials):n,l(a,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-list-layout-row",function(t){(t.PhotoListLayoutRow=function(t){this.top=t.top,this.left=t.left,this.width=t.width,this.spacing=t.spacing,this.targetRowHeight=t.targetRowHeight,this.targetRowHeightTolerance=t.targetRowHeightTolerance,this.additionalHeight=t.additionalHeight||0,this.minAspectRatio=this.width/t.targetRowHeight*(1-t.targetRowHeightTolerance),this.maxAspectRatio=this.width/t.targetRowHeight*(1+t.targetRowHeightTolerance),this.edgeCaseMinRowHeight=t.edgeCaseMinRowHeight||Number.NEGATIVE_INFINITY,this.edgeCaseMaxRowHeight=t.edgeCaseMaxRowHeight||Number.POSITIVE_INFINITY,this.rightToLeft=t.rightToLeft,this.isBreakoutRow=t.isBreakoutRow,this.items=[],this.height=0}).prototype={addItem:function(i){var e,h,s,o=this.items.concat(i),a=this.width-(o.length-1)*this.spacing,g=o.reduce(function(t,i){return t+i.aspectRatio},0),n=a/this.targetRowHeight;return this.isBreakoutRow&&0===this.items.length&&i.aspectRatio>=1?(this.items.push(t.merge(i)),this._completeLayout(a/i.aspectRatio),!0):0!==g&&(g<this.minAspectRatio?(this.items.push(t.merge(i)),!0):g>this.maxAspectRatio?0===this.items.length?(this.items.push(t.merge(i)),this._completeLayout(a/g),!0):(e=this.width-(this.items.length-1)*this.spacing,h=this.items.reduce(function(t,i){return t+i.aspectRatio},0),s=e/this.targetRowHeight,Math.abs(g-n)>Math.abs(h-s)?(this._completeLayout(e/h),!1):(this.items.push(t.merge(i)),this._completeLayout(a/g),!0)):(this.items.push(t.merge(i)),this._completeLayout(a/g),!0))},forceComplete:function(t,i){var e=this.width-(this.items.length-1)*this.spacing,h=this.items.reduce(function(t,i){return t+i.aspectRatio},0);"number"==typeof i?this._completeLayout(i-this.additionalHeight,!1):t?this._completeLayout(e/h):this._completeLayout(this.targetRowHeight-this.additionalHeight,!1)},isLayoutComplete:function(){return this.height>0},getItems:function(){return this.rightToLeft?this.items.reverse():this.items},getIndexOfItem:function(t){var i=-1;return this.items.some(function(e,h){if(e.id===t)return i=h,!0}),i},setTop:function(t){this.top=t,this.items.forEach(function(i){i.geometry.top=t})},_completeLayout:function(t,i){var e,h,s,o,a,g,n=this.rightToLeft?-this.left:this.left,r=this.width-(this.items.length-1)*this.spacing,m=this;void 0===i&&(i=!0),(h=Math.round(t))!==(s=Math.max(this.edgeCaseMinRowHeight,Math.min(h,this.edgeCaseMaxRowHeight)))?(this.height=s,e=r/s/(r/h)):(this.height=h,e=1),this.items.forEach(function(t,i){t.geometry={top:m.top,width:Math.round(t.aspectRatio*m.height*e),height:m.height+m.additionalHeight},m.rightToLeft?t.geometry.left=m.width-n-t.geometry.width:t.geometry.left=n,n+=t.geometry.width+m.spacing}),this.height+=m.additionalHeight,i&&(this.rightToLeft||(n-=this.spacing+this.left),o=(n-this.width)/this.items.length,a=this.items.map(function(t,i){return Math.round((i+1)*o)}),1===this.items.length?((g=this.items[0].geometry).width-=Math.round(o),this.rightToLeft&&(g.left+=Math.round(o))):this.items.forEach(function(t,i){i>0?(t.geometry.left-=a[i-1],t.geometry.width-=a[i]-a[i-1]):t.geometry.width-=a[i]}))}}},"@VERSION@",{requires:[]});YUI.add("photo-list-layout",function(t,e){var i=require("hermes-core/flog")(e),a={containerPadding:{top:8,right:8,bottom:8,left:8},itemSpacing:{horizontal:8,vertical:8},targetRowHeight:320,targetRowHeightTolerance:.25,awakeBoundsToViewportSizeRatio:3,maxNumRows:Number.POSITIVE_INFINITY,forceAspectRatio:Number.NaN,alwaysDisplayOrphans:!1,sleepTopAndBottom:!0,sleepLeftAndRight:!1,fullWidthBreakoutRowCadence:!1,deferWakeSleepUntil:2500};(t.PhotoListLayout=function(e){if(!e.appContext)throw new Error("PhotoListLayout must be instantiated with `params.appContext`.");e=t.merge(a,e),this.appContext=e.appContext,this.containerWidth=e.containerWidth,this.viewportContainerNodeHeight=e.viewportContainerNodeHeight||this.appContext.viewportData.getHeight(),this.containerPadding=e.containerPadding,this.itemSpacing=e.itemSpacing,this.targetRowHeight=e.targetRowHeight,this.targetRowHeightTolerance=e.targetRowHeightTolerance,this.awakeBoundsToViewportSizeRatio=e.awakeBoundsToViewportSizeRatio,this.maxNumRows=e.maxNumRows,this.forceAspectRatio=e.forceAspectRatio,this.alwaysDisplayOrphans=e.alwaysDisplayOrphans,this.sleepTopAndBottom=e.sleepTopAndBottom,this.sleepLeftAndRight=e.sleepLeftAndRight,this.fullWidthBreakoutRowCadence=e.fullWidthBreakoutRowCadence,this.deferWakeSleepUntil=e.deferWakeSleepUntil,this.additionalHeight=e.additionalHeight||0,this._layoutItems=[],this._awakeItems=[],this._inViewportItems=[],this._leadingOrphans=[],this._trailingOrphans=[],this._containerHeight=this.containerPadding.top,this._rows=[],this._orphans=[]}).prototype={getCurrentLayout:function(){return this._layoutItems.concat()},getAwakeItems:function(){return this._awakeItems.concat()},getInViewportItems:function(){return this._inViewportItems.concat()},hasLimitedNumberOfRows:function(){return this.maxNumRows!==a.maxNumRows},getLayoutItem:function(t){var e=null;return this._layoutItems.some(function(i){if(i.id===t)return e=i,!0}),e},getItemsInRow:function(t){return this._rows.length<=t?[]:this._rows[t].items.concat()},invalidateItem:function(t){var e,i=function(i,a,o){if(i.id===t)return o.splice(a,1),e=!0,!0};return this._layoutItems.some(i),this._leadingOrphans.some(i),this._trailingOrphans.some(i),this._rows.some(function(t){return t.items.some(i)}),this._orphans.some(i),e},clear:function(){this._layoutItems=[],this._leadingOrphans=[],this._trailingOrphans=[],this._containerHeight=this.containerPadding.top,this._rows=[],this._orphans=[]},updateTargetRowHeight:function(t){this.targetRowHeight=t,this.updatedRowHeight=this.targetRowHeight},computeLayout:function(t,e,a,o){var s,n,h,r,l,c,g,p,u,d={},m=[],w=[],f=[],_=!1,y=this;switch(this.containerWidth||(i.log("No valid containerWidth set on photo-list-layout; falling back to default"),this.containerWidth=1060),t||(t=[]),this.forceAspectRatio&&t.forEach(function(t){t.forcedAspectRatio=!0,t.aspectRatio=y.forceAspectRatio}),s=this._layoutItems.concat(),this._layoutItems.forEach(function(t){d[t.id]=t}),o||(o={diffType:"append"}),o.diffType){case"prepend":t=t.concat(this._leadingOrphans),this._leadingOrphans=[],t.reverse(),_=!0;break;case"merge":i.log("Due to the whims of product management, `merge` layouts are not yet implemented."),this.updateLayoutFrom(t,o.mergeStartIndex);break;case"relayout":o.diffDirection?"top"===o.diffDirection?t=t.concat(this._leadingOrphans.concat(this._layoutItems.concat(this._trailingOrphans))):"bottom"===o.diffDirection&&(t=this._leadingOrphans.concat(this._layoutItems.concat(this._trailingOrphans)).concat(t)):t=this._leadingOrphans.concat(this._layoutItems.concat(this._trailingOrphans)),this.clear();break;case"append":default:t=this._trailingOrphans.concat(t),this._trailingOrphans=[],this._rows.length>1&&(this._containerHeight=this._containerHeight-this.containerPadding.bottom+this.itemSpacing.vertical)}return t.some(function(t,e){if(r=!1,n||(n=y.createNewRow(_)),h=n.addItem(t),n.isLayoutComplete()){if(m=m.concat(y.addRow(n,_)),y._rows.length>=y.maxNumRows)return n=null,!0;if(n=y.createNewRow(_),!h)if(h=n.addItem(t),n.isLayoutComplete()){if(m=m.concat(y.addRow(n,_)),y._rows.length>=y.maxNumRows)return n=null,!0;n=y.createNewRow(_)}else h||(r=!0)}else h||(r=!0);r&&i.warn("computeLayout() Item not added and layout not complete",t)}),this._rows.length>=this.maxNumRows?(this._layoutItems||(i.warn("computeLayout() LayoutItems are unexpectedly undefined"),this._layoutItems=[]),this._trailingOrphans=t.slice(this._layoutItems.length)):n&&n.getItems().length&&(_?o.firstPage?(n.forceComplete(!0),m=m.concat(y.addRow(n,_))):this._leadingOrphans=n.getItems().reverse():o.lastPage||this.alwaysDisplayOrphans?(this._rows.length?(u=this._rows[this._rows.length-1].isBreakoutRow?this._rows[this._rows.length-1].targetRowHeight:this._rows[this._rows.length-1].height,n.forceComplete(!1,this.updatedRowHeight||u)):this.alwaysDisplayOrphans&&s.length?s[s.length-1].geometry&&n.forceComplete(!1,this.updatedRowHeight||s[s.length-1].geometry.height):n.forceComplete(!1),m=m.concat(y.addRow(n,_)),delete this.updatedRowHeight):this._trailingOrphans=n.getItems().concat()),m.forEach(function(t){d[t.id]?f.push(t):w.push(t)}),this._containerHeight=this._containerHeight-this.itemSpacing.vertical+this.containerPadding.bottom,_&&(p=this.containerPadding.top,this._rows.forEach(function(t){t.setTop(p),p+=t.height+y.itemSpacing.vertical}),f=s.concat()),g=this.computeWakeSleep(e,a,d),l=g.wakeSleepChangedItems,c=g.inViewportChangedItems,this._trailingOrphans.concat(this._leadingOrphans).forEach(function(t){d[t.id]&&(t.isAwake=!1,l.push(t))}),{allLayoutItems:this._layoutItems.concat(),newItems:w,layoutChangedItems:f,wakeSleepChangedItems:l,inViewportChangedItems:c,leadingOrphans:this._leadingOrphans.concat(),trailingOrphans:this._trailingOrphans.concat(),containerHeight:this._containerHeight}},computeWakeSleep:function(t,e,a){var o=this._awakeItems=[],s=this._inViewportItems=[];t||(t=0),e||(e=0),this.viewportContainerNodeHeight||(i.log("No valid viewport height available for photo-list-layout; falling back to default"),this.viewportContainerNodeHeight=1e3);var n,h,r,l,c,g=this.viewportContainerNodeHeight,p=.5*g*(this.awakeBoundsToViewportSizeRatio-1),u=t,d=t+g,m=u-p,w=d+p,f=[],_=[],y=this._layoutItems.length<this.deferWakeSleepUntil,I=this;return this.sleepLeftAndRight&&(h=.5*(n=this.appContext.viewportData.getWidth())*(this.awakeBoundsToViewportSizeRatio-1),r=e-h,l=e+n+h),this._layoutItems.forEach(function(t){a&&(c=a[t.id]),y?t.isAwake=!0:(I.sleepTopAndBottom?t.isAwake=t.geometry.top+t.geometry.height>=m&&t.geometry.top<w:t.isAwake=!0,t.isAwake&&I.sleepLeftAndRight&&(t.isAwake=t.geometry.left+t.geometry.width>=r&&t.geometry.left<l)),c&&c.isAwake===t.isAwake||f.push(t),t.isAwake&&o.push(t),t.isInViewport=t.geometry.top+t.geometry.height>=u&&t.geometry.top<d,_.push(t),t.isInViewport&&s.push(t)}),{allLayoutItems:a?this._layoutItems:this._layoutItems.concat(),newItems:[],layoutChangedItems:[],wakeSleepChangedItems:f,inViewportChangedItems:_,leadingOrphans:this._leadingOrphans.concat(),trailingOrphans:this._trailingOrphans.concat(),containerHeight:this._containerHeight}},updateLayoutFrom:function(t,e){var i,a,o,s;this._layoutItems.length&&this._layoutItems.length>e&&(i=this._layoutItems[e],(a=this.getRowOfItem(i.id))&&(this._rows=this._rows.slice(0,a.index),o=this._rows[this._rows.length-1],this._containerHeight=o?o.top+o.height:0,a.indexInRow>0&&(s=(s=this._layoutItems.splice(-a.indexInRow)).map(function(t){return{id:t.id,aspectRatio:t.aspectRatio,layoutType:t.layoutType}}),t.unshift.apply(t,s))),this._layoutItems=this._layoutItems.slice(0,Math.min(this._layoutItems.length,e)))},createNewRow:function(e){var i=!1;return!1!==this.fullWidthBreakoutRowCadence&&(this._rows.length+1)%this.fullWidthBreakoutRowCadence==0&&(i=!0),new t.PhotoListLayoutRow({top:this._containerHeight,left:this.containerPadding.left,width:this.containerWidth-this.containerPadding.left-this.containerPadding.right,spacing:this.itemSpacing.horizontal,targetRowHeight:this.targetRowHeight,targetRowHeightTolerance:this.targetRowHeightTolerance,edgeCaseMinRowHeight:.5*this.targetRowHeight,edgeCaseMaxRowHeight:2*this.targetRowHeight,rightToLeft:e,isBreakoutRow:i,additionalHeight:this.additionalHeight})},addRow:function(t,e){return e?(this._rows.unshift(t),this._layoutItems=t.getItems().reverse().concat(this._layoutItems)):(this._rows.push(t),this._layoutItems=this._layoutItems.concat(t.getItems())),this._containerHeight+=t.height+this.itemSpacing.vertical,t.items},getRowOfItem:function(t){var e,i,a;for(i=0;i<this._rows.length;i++)if(e=this._rows[i],-1!==(a=e.getIndexOfItem(t)))return{row:e,index:i,indexInRow:a};return null}}},"@VERSION@",{requires:["photo-list-layout-row"]});YUI.add("hermes-template-photo-card-overlay-icon",function(n,e){var o=n.Template.Handlebars.revive({1:function(n,e,o,l,a){return"\t\tautoplay\n"},3:function(n,e,o,l,a){return"\t\tvideo\n"},5:function(n,e,o,l,a){return"\t\tplay\n\t"},7:function(n,e,o,l,a){return'\t\t<svg class="icon icon-autoplay"><use xlink:href="#icon-autoplay"></use></svg>\n'},9:function(n,e,o,l,a){return'\t\t<svg class="icon icon-video"><use xlink:href="#icon-video"></use></svg>\n'},11:function(n,e,o,l,a){return'\t\t<svg class="icon icon-play"><use xlink:href="#icon-play"></use></svg>\n'},compiler:[8,">= 4.3.0"],main:function(n,e,o,l,a){var t,i=null!=e?e:n.nullContext||{},r=n.hooks.helperMissing,u=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'<div class="photo-card-overlay-icon\n'+(null!=(t=(u(o,"ifCond")||e&&u(e,"ifCond")||r).call(i,null!=e?u(e,"type"):e,"===","autoplay",{name:"ifCond",hash:{},fn:n.program(1,a,0),inverse:n.noop,data:a,loc:{start:{line:2,column:1},end:{line:4,column:12}}}))?t:"")+(null!=(t=(u(o,"ifCond")||e&&u(e,"ifCond")||r).call(i,null!=e?u(e,"type"):e,"===","video",{name:"ifCond",hash:{},fn:n.program(3,a,0),inverse:n.noop,data:a,loc:{start:{line:5,column:1},end:{line:7,column:12}}}))?t:"")+(null!=(t=(u(o,"ifCond")||e&&u(e,"ifCond")||r).call(i,null!=e?u(e,"type"):e,"===","play",{name:"ifCond",hash:{},fn:n.program(5,a,0),inverse:n.noop,data:a,loc:{start:{line:8,column:1},end:{line:10,column:12}}}))?t:"")+'">\n\n'+(null!=(t=(u(o,"ifCond")||e&&u(e,"ifCond")||r).call(i,null!=e?u(e,"type"):e,"===","autoplay",{name:"ifCond",hash:{},fn:n.program(7,a,0),inverse:n.noop,data:a,loc:{start:{line:12,column:1},end:{line:14,column:12}}}))?t:"")+"\n"+(null!=(t=(u(o,"ifCond")||e&&u(e,"ifCond")||r).call(i,null!=e?u(e,"type"):e,"===","video",{name:"ifCond",hash:{},fn:n.program(9,a,0),inverse:n.noop,data:a,loc:{start:{line:16,column:1},end:{line:18,column:12}}}))?t:"")+"\n"+(null!=(t=(u(o,"ifCond")||e&&u(e,"ifCond")||r).call(i,null!=e?u(e,"type"):e,"===","play",{name:"ifCond",hash:{},fn:n.program(11,a,0),inverse:n.noop,data:a,loc:{start:{line:20,column:1},end:{line:22,column:12}}}))?t:"")+"\n</div>"},useData:!0}),l={};n.Array.each([],function(e){var o=n.Template.get("hermes/"+e);o&&(l[e]=o)}),n.Template.register("hermes/photo-card-overlay-icon",function(e,a){return a=a||{},a.partials=a.partials?n.merge(l,a.partials):l,o(e,a)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-photo-list-photo",function(e,n){var t=e.Template.Handlebars.revive({1:function(e,n,t,r,o){var a,l=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(a=e.invokePartial(l(r,"photo-card-overlay-icon"),n,{name:"photo-card-overlay-icon",hash:{type:"video"},data:o,indent:"\t",helpers:t,partials:r,decorators:e.decorators}))?a:""},3:function(e,n,t,r,o){var a,l=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return(null!=(a=l(t,"if").call(null!=n?n:e.nullContext||{},null!=n?l(n,"showInteractionBarPlaceholder"):n,{name:"if",hash:{},fn:e.program(4,o,0),inverse:e.noop,data:o,loc:{start:{line:6,column:1},end:{line:8,column:8}}}))?a:"")+'\t<div class="interaction-view"></div>\n'},4:function(e,n,t,r,o){return'\t\t<div class="interaction-view-placeholder"></div>\n'},6:function(e,n,t,r,o){var a,l=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t<a class="click-target" href="'+e.escapeExpression("function"==typeof(a=null!=(a=l(t,"photoPageUrl")||(null!=n?l(n,"photoPageUrl"):n))?a:e.hooks.helperMissing)?a.call(null!=n?n:e.nullContext||{},{name:"photoPageUrl",hash:{},data:o,loc:{start:{line:11,column:31},end:{line:11,column:47}}}):a)+'" tabindex="0" role="heading" aria-level="3"></a>\n'},compiler:[8,">= 4.3.0"],main:function(e,n,t,r,o){var a,l=null!=n?n:e.nullContext||{},i=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return(null!=(a=i(t,"if").call(l,null!=n?i(n,"isVideo"):n,{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:1,column:0},end:{line:3,column:7}}}))?a:"")+"\n"+(null!=(a=i(t,"if").call(l,null!=n?i(n,"hasInteraction"):n,{name:"if",hash:{},fn:e.program(3,o,0),inverse:e.program(6,o,0),data:o,loc:{start:{line:5,column:0},end:{line:12,column:7}}}))?a:"")},usePartial:!0,useData:!0}),r={};e.Array.each(["photo-card-overlay-icon"],function(n){var t=e.Template.get("hermes/"+n);t&&(r[n]=t)}),e.Template.register("hermes/photo-list-photo",function(n,o){return o=o||{},o.partials=o.partials?e.merge(r,o.partials):r,t(n,o)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-photo-card-overlay-icon"]});YUI.add("photo-list-photo-view",function(e){var t=require("hermes-core/type-validator");e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.set("isZombie",!YUI.Env.isServer&&e.requiredToShowOnServer&&this.get("layoutItem")&&!this.get("layoutItem").isAwake),this.onlyShowCurateForOwner=e.onlyShowCurateForOwner,this},loadState:function(){var t=e.URLHelper.getPhotoPage({photoId:this.get("model").getValue("id"),pathAlias:this.get("model").getValue("owner").getValue("pathAlias"),contextSuffix:this.get("contextSuffix")});return this.set("photoPageUrl",t),e.Promise.resolve()},buildContainer:function(){var t,i=this.get("container"),r=this.get("layoutItem");if(r.isAwake)this.updateGeometry(),this.setContainerHTML(this.render()),YUI.Env.isServer?(i.setStyles({"background-image":"url("+this.get("photoUrl")+")"}),i.addClass("awake"),this.get("model").getValue("needsInterstitial")&&i.addClass("restricted-image")):(this.get("showLowResImageFirst")&&i.setStyles({backgroundImage:"url("+this.get("model").getValue("sizes").sq.url+")"}).addClass("low-res"),this.downloadCacheAndSetImage());else if(YUI.Env.isServer)this.set("isZombie",!0);else if(!YUI.Env.isServer||this.get("isZombie")){var n="";t=e.Node.create(this.get("placeHolderHTML")).set("innerHTML",this.render()),this.get("model").getValue("needsInterstitial")&&(n=" restricted-image"),t.setAttrs({id:i.getAttribute("id"),className:i.getAttribute("class")+n}),this.updateNodeGeometry(r,t),this.serialize(t),this.set("isReallySleeping",!0),this.set("isZombie",!1),this.downloadCacheAndSetImage()}return this.get("model").getValue("isVideo")&&this.get("container").addClass("is-video"),this.get("showInteractionBarPlaceholder")&&(this.get("model").getValue("aspectRatio")>1?i.addClass("landscape"):i.addClass("portrait")),this},activate:function(){var e;return this.renderInteractionView().then(function(e){this.fire("activated")}.bind(this)),this.get("showLowResImageFirst")&&((e=this.get("parentContainer").getDOMNode()).addEventListener("transitionend",this.removeTransition),e.addEventListener("webkitTransitionEnd",this.removeTransition)),this.registerEventHandler(this.get("interactionContainer").delegate(["blur","focus"],this.toggleKeyboardFocusStyling.bind(this),"a, .engagement-item")),this},toggleKeyboardFocusStyling:function(e){var t=e.target.ancestor(".interaction-view");t&&t.toggleClass("has-keyboard-focus","focus"===e.type)},setHoverVisible:function(e){var t=this.get("interactionContainer");t&&(e?t.addClass("manual-hover"):t.removeClass("manual-hover"))},render:function(){return this.templates("photo-list-photo")({photoPageUrl:this.get("photoPageUrl"),hasInteraction:!!this.get("interactionViewName")&&!this.appContext.forceServerRender,showInteractionBarPlaceholder:this.get("showInteractionBarPlaceholder"),isVideo:this.get("model").getValue("isVideo")})},removeTransition:function(e){e&&e.target&&e.target.classList&&e.target.classList.contains("photo-list-photo-view")&&e.target.classList.remove("low-res")},downloadCacheAndSetImage:function(){e.fluid.loadImage(this.get("photoUrl"),{timeout:1e3,retry:!0}).then(function(e){this.handleImageLoad(!0,e)}.bind(this),function(e){this.handleImageLoad(!1,e+"?retry="+Date.now())}.bind(this))},handleImageLoad:function(t,i){var r,n=this,a=this.get("isReallySleeping");(r=a?this.deserialize():this.get("container")).setStyle("backgroundImage","url("+i+")"),t||r.setStyle("backgroundColor","#eee"),this.get("model").getValue("needsInterstitial")&&r.addClass("restricted-image"),a?this.serialize(r):e.fluid.chill(function(){var e,i=this.get("container");a||(i.addClass("awake"),setTimeout(function(){(e=n.get("interactionView"))&&e.updateBreakpoints&&e.updateBreakpoints()},0),this.fire(t?"loaded":"loadError"))},this),r=null},updateGeometry:function(e){var t,i=this.get("isReallySleeping");e?this.set("layoutItem",e):e=this.get("layoutItem"),t=i?this.deserialize():this.get("container"),this.updateNodeGeometry(e,t),i&&this.serialize(t),t=null},updateNodeGeometry:function(t,i){YUI.Env.isServer?i.setStyles({transform:"translate("+t.geometry.left+"px, "+t.geometry.top+"px)","-webkit-transform":"translate("+t.geometry.left+"px, "+t.geometry.top+"px)","-ms-transform":"translate("+t.geometry.left+"px, "+t.geometry.top+"px)"}):e.fluid.setStylePrefixed("transform","translate("+t.geometry.left+"px, "+t.geometry.top+"px)",i),i.setStyles({width:t.geometry.width+"px",height:t.geometry.height+"px"})},sleep:function(){var t,i;this.get("isReallySleeping")||(YUI.Env.isServer?this.set("isZombie",!0):(this.get("id"),this.destroyInteractionView(),(i=this.get("container")).removeClass("awake"),this.serialize(i),t=e.Node.create(this.get("placeHolderHTML")),this.get("parentContainer").replaceChild(t,i),this.set("container",t),this.set("isReallySleeping",!0),this.set("isZombie",!1),i=null))},wake:function(){var t,i,r,n=this;this.get("isReallySleeping")&&(this.get("id"),t=this.get("container"),i=this.get("parentContainer"),r=this.deserialize(),i.replaceChild(r,t),this.set("container",r),this.set("isReallySleeping",!1),this.renderInteractionView(),e.fluid.chill(function(){var e;this.get("container").addClass("awake"),setTimeout(function(){(e=n.get("interactionView"))&&e.updateBreakpoints&&e.updateBreakpoints()},0)},this),t=null)},isAwake:function(){return!this.get("isReallySleeping")},serialize:function(t){if(YUI.Env.isServer)throw new Error("Impossible to `serialize` on the server (uses sessionStorage). Maybe you meant to call `sleep`?");t&&e.Storage.Instance.set(this.get("storageId"),t.getDOMNode().outerHTML)},deserialize:function(){if(YUI.Env.isServer)throw new Error("Impossible to `deserialize` on the server (uses sessionStorage). Maybe you meant to call `wake`?");var t,i=e.Storage.Instance.get(this.get("storageId"));return i&&(t=e.Node.create(i),this.dematerialize()),t},dematerialize:function(){if(YUI.Env.isServer)throw new Error("Impossible to `dematerialize` on the server (uses sessionStorage).");e.Storage.Instance.remove(this.get("storageId"))},renderInteractionView:function(){var t,i,r=this,n=this.get("interactionViewName"),a=this.get("interactionView");return n&&!a?(i=this.onlyShowCurateForOwner?this.get("model").getValue("isOwner"):void 0,this.appContext.getView(n,e.merge(this._params,{id:this.get("id"),container:this.get("interactionContainer"),model:this.get("model"),listModelParams:this.get("listModelParams"),photoPageUrl:this.get("photoPageUrl"),isActiveViewAgnostic:this.get("isActiveViewAgnostic"),engagementModelName:this.get("engagementModelName"),layoutWidth:this.get("layoutItem").geometry.width,showCurate:i})).then(function(e){return this.set("interactionView",e),this.registerEventHandler(this.get("interactionView").on("hoverActionOpened",this.setHoverVisible.bind(this,!0))),this.registerEventHandler(this.get("interactionView").on("hoverActionClosed",this.setHoverVisible.bind(this,!1))),e.initialize()}.bind(this)).then(function(e){return setTimeout(function(){r.isAwake()&&e&&e.updateBreakpoints&&e.updateBreakpoints()},0),e})):a?(a.get("container").inDoc()||((t=a.get("container")).addClass("interaction-view"),this.get("interactionContainer")||this.buildContainer(),this.get("container").replaceChild(t,this.get("interactionContainer")),a.normalizedActivate(),setTimeout(function(){a&&a.updateBreakpoints&&a.updateBreakpoints()},0)),e.Promise.resolve(a)):e.Promise.resolve(null)},destroyInteractionView:function(){var e=this.get("interactionView");e&&(e.destroy(),this.set("interactionView",null))},destructor:function(){this.dematerialize()}},{ATTRS:{id:{writeOnce:"initOnly",validator:function(e,i){return t.photoId(e)}},parentSignature:{writeOnce:"initOnly"},storageId:{readOnly:!0,derivedBy:["id","parentSignature"],getter:function(){return this.get("parentSignature")+"-"+this.get("id")}},layoutItem:{validator:function(e,t){return"object"==typeof e&&e.hasOwnProperty("aspectRatio")&&e.hasOwnProperty("geometry")&&"object"==typeof e.geometry&&e.geometry.hasOwnProperty("width")&&e.geometry.hasOwnProperty("height")&&e.geometry.hasOwnProperty("top")&&e.geometry.hasOwnProperty("left")&&e.hasOwnProperty("isAwake")}},photoUrl:{value:"/images/spaceball.gif",getter:function(e,t){var i,r=this.get("model"),n=this.get("layoutItem"),a={};return this.get("showInteractionBarPlaceholder")?(r.getValue("aspectRatio")>1?a.height=n.geometry.height-(this.get("interactionBarHeight")||0):a.width=n.geometry.width,i=r.getSizeToFit(a,{includeSquare:1===n.aspectRatio})):i=r.getSizeToFit({width:n.geometry.width,height:n.geometry.height},{includeSquare:1===n.aspectRatio}),i.url}},photoPageUrl:{writeOnce:!0,validator:function(t,i){return e.AttributeHelpers.validateString(t)}},model:{value:null},listModelParams:{value:null},parentContainer:{writeOnce:"initOnly"},contextSuffix:{writeOnce:"initOnly",value:null,validator:function(t,i){return e.AttributeHelpers.validateString(t)}},measureAFT:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},isReallySleeping:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},isZombie:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},placeHolderHTML:{value:'<div class="youcansleepwhenyouredead" />',validator:function(t,i){return e.AttributeHelpers.validateString(t)}},showLowResImageFirst:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},interactionViewName:{writeOnce:"initOnly",value:null,validator:function(t,i){return e.AttributeHelpers.validateString(t)}},showInteractionBarPlaceholder:{writeOnce:"initOnly",value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},interactionBarHeight:{writeOnce:"initOnly",value:null,validator:function(t,i){return e.AttributeHelpers.validateInteger(t)}},engagementModelName:{writeOnce:"initOnly",value:null,validator:function(t,i){return e.AttributeHelpers.validateString(t)}},interactionView:{value:null},interactionContainer:{value:null,getter:function(e,t){return e||YUI.Env.isServer||(e=this.get("container").one(".interaction-view")),e}}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-list-photo","url-helper","attribute-helpers"],optionalRequires:["fluid","storage-helper"],langBundles:["common"]});