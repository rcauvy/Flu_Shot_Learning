YUI.add("flickr-groups-pools-getContext-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-groups-pools-getContext"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.groups.pools.getContext",this._processParams(t),!0),s.getModelRegistry("group-pool-models"),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then(function(e){return r._processResponse(e,t)},function(e){throw 2===e.code&&"Photo not in pool"===e.message&&(e.notInContext=!0),e}).then(null,e.FetcherErrorLogger(o))},_processParams:function(o){var t={photo_id:o.photoId,extras:e.APIHelper.request.getRebootPhotoExtras()+",datecreate",num_prev:o.numNext,num_next:o.numPrev,get_group_info:1};if(o.id)t.group_id=o.id;else{if(!o.pathAlias)throw new Error("[flickr-groups-pools-getPhotos-fetcher] `id` or `pathAlias` is required.");t.group_path_alias=o.pathAlias}return t},_processResponse:function(o,t){var s,r,n,p,i,a,l=o[0],h=o[1],g=o[2],d=o[3],u=o[4],m=o[5],c=[],x=[],y=g.proxy(t.photoId),M=[];return s=l.prevphotos,r=l.nextphotos,x=e.APIHelper.response.parsePhotos({photos:s.photo,personModelRegistry:d,photoModelRegistry:g,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),c=e.APIHelper.response.parsePhotos({photos:r.photo,personModelRegistry:d,photoModelRegistry:g,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),a=h.getValue(t.id,"photoContextList"),p=!!a.hasMinBoundary&&a.hasMinBoundary(),i=!!a.hasMaxBoundary&&a.hasMaxBoundary(),n=a.getList(),M=e.APIHelper.response.addOrReplaceListByContext({model:y,next:x,prev:c.reverse(),current:n,hasMin:p,hasMax:i,numNext:t.numNext,numPrev:t.numPrev}),h.setValue(t.id,"photoContextList",M),{next:x,previous:c.reverse()}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","photo-engagement-models","photo-stats-models","group-models"]});YUI.add("flickr-groups-pools-add-creator",function(o,e){"use strict";o.namespace("ModelCreators")["flickr-groups-pools-add"]={run:function(t,r){var p=this,s=this._processParams(t),l=t.registryName||"group-pool-models",u={apiResponse:r.callAPI("flickr.groups.pools.add",s),groupPoolModel:r.getModel(l,t.groupID),photoModel:r.getModel("photo-models",t.photoID),photoGroupsModelRegistry:r.getModelRegistry("photo-groups-models"),photoContextsModelRegistry:r.getModelRegistry("photo-contexts-models")};return t.unfilteredGroupId=s.group_id,"group-pool-models"!==l&&(u.unfilteredGroupPoolModel=r.getModel("group-pool-models",t.unfilteredGroupId)),new o.FlickrPromise(u).then(function(o){return p._processResponse(o,t)},o.FetcherErrorLogger(e))},_processParams:function(e){return{photo_id:e.photoID,group_id:o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID),detailed_errors:1}},_processResponse:function(e,t){var r=e.apiResponse,p=e.groupPoolModel,s=e.photoModel,l=e.photoGroupsModelRegistry,u=e.photoContextsModelRegistry,d=e.unfilteredGroupPoolModel;if("ok"===r.stat){if(p&&!p.hasPhoto(s.getValue("id"))&&p.addPhotoLocal(s),d&&!d.hasPhoto(s.getValue("id"))&&d.addPhotoLocal(s),l.exists(t.photoID)&&!l.getValue(t.photoID,"groups").getFromListByID(t.unfilteredGroupId)&&(l.getValue(t.photoID,"groups").unshift(p),l.setValue(t.photoID,"total",l.getValue(t.photoID,"total")+1)),u.exists(t.photoID)&&!u.getValue(t.photoID,"contexts").getFromListByID(t.unfilteredGroupId)&&(u.setValue(t.photoID,"totalGroups",u.getValue(t.photoID,"totalGroups")+1),u.getValue(t.photoID,"contexts").push(p)),o.Snowplough){var a={id:p.getValue("id")},g={id:s.id,safetyLevel:s.getValue("safetyLevel")},i=[];i=(i=i.concat(o.Snowplough.getGroupContext(a))).concat(o.Snowplough.getPhotoContext(g)),o.Snowplough.sendStructuredEvent({category:"group",action:"add_photo"},i)}return p}}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("flickr-groups-pools-remove-deletor",function(o,e){"use strict";o.namespace("ModelDeletors")["flickr-groups-pools-remove"]={run:function(t,r){var s,l,p=this,d=t.registryName||"group-pool-models",i=[];return t.photoID?t.photoIds=[t.photoID]:t.photoIds="string"==typeof t.photoIds?[t.photoIds]:t.photoIds,s=this._processParams(t),l={apiResponse:r.callAPI("flickr.groups.pools.remove",s),groupPoolModelRegistry:r.getModel(d,t.groupID),photoGroupsModelRegistry:r.getModelRegistry("photo-groups-models"),photoContextsModelRegistry:r.getModelRegistry("photo-contexts-models")},t.photoIds.forEach(function(o){i.push(r.getModel("photo-models",o))}),l.photoModels=o.Promise.all(i),t.unfilteredGroupId=s.group_id,"group-pool-models"!==d&&(l.unfilteredGroupPoolModelRegistry=r.getModel("group-pool-models",t.unfilteredGroupId)),new o.FlickrPromise(l).then(function(o){return p._processResponse(o,t)},o.FetcherErrorLogger(e))},_processParams:function(e){return{photo_id:e.photoIds.join(","),group_id:o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID)}},_processResponse:function(o,e){var t=o.apiResponse,r=o.groupPoolModelRegistry,s=o.photoModels,l=o.photoGroupsModelRegistry,p=o.photoContextsModelRegistry,d=o.unfilteredGroupPoolModelRegistry;if("ok"===t.stat)return s.forEach(function(o){p.exists(o.id)&&p.getValue(o.id,"contexts").getFromListByID(e.unfilteredGroupId)&&(p.setValue(o.id,"totalGroups",p.getValue(o.id,"totalGroups")-1),p.getValue(o.id,"contexts").removeFromList(e.unfilteredGroupId)),l.exists(o.id)&&l.getValue(o.id,"groups").getFromListByID(e.unfilteredGroupId)&&(l.setValue(o.id,"total",l.getValue(o.id,"total")-1),l.getValue(o.id,"groups").removeFromList(e.unfilteredGroupId)),r&&r.hasPhoto(o.getValue("id"))&&r.removePhotoLocal(o),d&&d.hasPhoto(o.getValue("id"))&&d.removePhotoLocal(o)}),r}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("flickr-groups-invite-photo-invite-creator",function(o,t){"use strict";o.namespace("ModelCreators")["flickr-groups-invite-photo-invite"]={run:function(e,i){var r={},p=o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID);return r.photo_id=e.photoID,r.group_id=p,o.Promise.all([i.callAPI("flickr.groups.invite.photo.invite",r),i.getModel("group-pool-models",p),i.getModelRegistry("photo-group-invitation-models"),i.getModelRegistry("photo-group-invitations-models")]).then(function(t){var r,n,l,s=t[0],u=t[1],g=t[2],a=t[3];if("ok"===s.stat){if(r=[e.photoID,p].join("-"),n={id:r,photoId:e.photoID,groupId:p,invitedBy:i.getViewer().nsid},l=g.exists(r)?g.proxy(r):g.add(n),a.exists(e.photoID)&&!a.getValue(e.photoID,"invitations").getFromListByID(r)&&(a.getValue(e.photoID,"groups").prependToList(u),a.getValue(e.photoID,"invitations").prependToList(l),a.setValue(e.photoID,"total",a.getValue(e.photoID,"total")+1)),o.Snowplough){var d={id:p},h=[];h=h.concat(o.Snowplough.getGroupContext(d)),i.getModel("photo-models",e.photoID).then(function(t){var e=t.getValue("safetyLevel"),i={id:t.id,safetyLevel:e};o.Snowplough.sendStructuredEvent({category:"group",action:"invite_photo"},h.concat(o.Snowplough.getPhotoContext(i)))}.bind(this))}return u}},o.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("flickr-groups-invite-photo-cancel-deletor",function(o,t){"use strict";o.namespace("ModelDeletors")["flickr-groups-invite-photo-cancel"]={run:function(e,r){var i={},l=o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID);return i.photo_id=e.photoID,i.group_id=l,o.Promise.all([r.callAPI("flickr.groups.invite.photo.cancel",i),r.getModel("group-pool-models",l),r.getModelRegistry("photo-group-invitation-models"),r.getModelRegistry("photo-group-invitations-models")]).then(function(o){var t,r=o[0],i=o[1],p=o[2],s=o[3];if("ok"===r.stat)return t=[e.photoID,l].join("-"),s.exists(e.photoID)&&s.getValue(e.photoID,"invitations").getFromListByID(t)&&(s.setValue(e.photoID,"total",s.getValue(e.photoID,"total")-1),s.getValue(e.photoID,"groups").removeFromList(l),s.getValue(e.photoID,"invitations").removeFromList(t)),p.remove(t),i},o.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("group-pool-by-person-models",function(e){function o(e){o.superclass.constructor.call(this,e)}e.Models[this.name]=o,e.extend(o,e.Models["group-pool-models"],{name:this.name,attributes:e.merge(e.Models["group-pool-models"].prototype.attributes,{personFilter:{validator:function(o,r){return e.AttributeHelpers.validateString(o)},setter:function(o){return e.AttributeHelpers.coerceString(o)},defaultValue:null}})})},"@VERSION@",{requires:["attribute-helpers","group-pool-models","flickr-groups-pools-getPhotos-fetcher","flickr-groups-pools-add-creator","flickr-groups-pools-remove-deletor","flickr-groups-invite-photo-invite-creator","flickr-groups-invite-photo-cancel-deletor"]});